!function(a,s,l){"use strict";a.fn.vlsGfAlbum=function(l){function t(){a(s).on("resize.vls-gf",function(){n.each(function(){a(this).data("vlsGfAlbum").updateLayout()})}),a().vlsGfLazyload&&a(".vls-gf-album img[data-original]").vlsGfLazyload({threshold:100,effect:"fadeIn"}),n.each(function(){a.data(this,"vlsGfAlbum",new e(this))})}function e(l){function t(){m.removeClass("no-js"),m.hasClass("vls-gf-album-metro")&&(G="metro",a(s).on("resize.vls-gf-"+b,e)),m.hasClass("vls-gf-paginated-paged-numbers")?C="numbers":m.hasClass("vls-gf-paginated-paged-bullets")?C="bullets":m.hasClass("vls-gf-paginated-load-more")?C="load-more":m.hasClass("vls-gf-paginated-load-scroll")&&(C="load-scroll"),"none"!=C&&(c=a("<div />").addClass("vls-gf-pagination-control").appendTo(m)),y>1&&("numbers"==C||"bullets"==C?i():"load-more"==C?f():"load-scroll"==C&&o()),e()}function e(){"metro"==G&&n(!0)}function n(l){if(a(s).width()<=640)return m.find(".vls-gf-thumbnail-container").css("height",""),!0;for(var t,e=m.data("vlsGfAspectRatio"),f=m.data("vlsGfHorizontalSpacing"),o=m.data("vlsGfVerticalSpacing"),i=m.data("vlsGfColumnCount"),r=Math.floor(m[0].getBoundingClientRect().width),d=[],g=0,v=-1,u=0,p=r-f*(i-1),c=Math.floor(p/i),h=p-c*i,b=0;i>b;b++)d[b]=c,h>0&&(d[b]++,h--);g=Math.round(c/e),m.find('.vls-gf-page:not(".vls-gf-hidden") .vls-gf-item').each(function(){var s=a(this),l=s.data("vlsGfImageAspect"),t=s.data("vlsGfWidth"),e=s.data("vlsGfHeight"),n=s.data("vlsGfCol"),i=s.data("vlsGfRow"),r=0,p=0,c=0,h=0;0>v&&(v=i);var m=i-v;for(b=n;n+t>b;b++)r+=d[b];for(r+=f*(t-1),p=g*e+o*(e-1),b=0;n>b;b++)c+=d[b];c+=f*n,h=g*m+o*m,s.css({width:r,height:p,left:c,top:h}),r/p>l?s.find("img").removeClass("vls-gf-wide").addClass("vls-gf-tall"):s.find("img").removeClass("vls-gf-tall").addClass("vls-gf-wide"),m+e-1>u&&(u=m+e-1)}),t=g*(u+1)+o*u,m.find(".vls-gf-thumbnail-container").css("height",t+"px"),l&&r!=parseInt(m.width())&&n(!1)}function f(){"load-more"==C&&(h=a("<button />").text(vls_gf_script_l10n.btnTextLoadMore).appendTo(c),h.on("click.vls-gf",g),a("<span/>").appendTo(c))}function o(){"load-scroll"==C&&(a("<span/>").appendTo(c),a(s).on("scroll.vls-gf-"+b,v),v())}function i(){if("numbers"==C||"bullets"==C){var s,l=[],t=[];if(7>=y||"bullets"==C)for(s=1;y>=s;s++)t.push(s);else if(3>=_){for(s=1;5>=s;s++)t.push(s);t.push(0),t.push(y)}else if(_>y-3)for(t.push(1),t.push(0),s=y-4;y>=s;s++)t.push(s);else{for(t.push(1),t.push(0),s=_-1;_+1>=s;s++)t.push(s);t.push(0),t.push(y)}for("numbers"==C&&(e=a("<a/>",{text:"<<"}),_>1?(e.attr("href","#page/"+(_-1)),e.on("click.vls-gf",function(){var s=parseInt(a(this).attr("href").replace("#page/",""));return r(s),!1})):e.addClass("vls-gf-disabled"),l.push(e)),s=0;s<t.length;s++){var e,n=t[s];0==n?(e=a("<span />",{text:"..."}),l.push(e)):(e=a("<a/>",{href:"#page/"+n,text:"numbers"==C?n:""}),n==_&&e.addClass("vls-gf-active"),e.on("click.vls-gf",function(s){var l=parseInt(a(this).attr("href").replace("#page/",""));return r(l),s.preventDefault(),!1}),l.push(e))}"numbers"==C&&(e=a("<a/>",{text:">>"}),y>_?(e.attr("href","#page/"+(_+1)),e.on("click.vls-gf",function(){var s=parseInt(a(this).attr("href").replace("#page/",""));return r(s),!1})):e.addClass("vls-gf-disabled"),l.push(e)),c.empty().append(l)}}function r(s){_=s,i();var l=m.find('.vls-gf-page[data-vls-gf-page-no="'+s+'"]');l.length>0?d(l):a.get(vls_gf_script_l10n.ajaxurl,{action:"vls_gf_get_album_page",album_id:b,page_no:s},function(s){m.find(".vls-gf-thumbnail-container").append(s);var l=m.find(".vls-gf-page:last");d(l),a().vlsGfLazyload&&l.find("img[data-original]").vlsGfLazyload({threshold:100,effect:"fadeIn"})},"html")}function d(s){s.removeClass("vls-gf-hidden");var l=s.data("vlsGfPageNo");m.find(".vls-gf-page").each(function(){var s=a(this);s.data("vlsGfPageNo")!=l&&s.addClass("vls-gf-hidden")}),e(),p(s);var t=s.closest(".vls-gf-album").data("vlsGfLightbox");t&&"function"==typeof t.updateTargets&&t.updateTargets(s,!1)}function g(){if(T)return!1;T=!0,c.addClass("vls-gf-busy"),_++;var l=m.find('.vls-gf-page[data-vls-gf-page-no="'+_+'"]');return l.length>0?(u(l),T=!1,c.removeClass("vls-gf-busy"),_>=y&&(a(s).off("scroll.vls-gf-"+b),c.remove())):a.get(vls_gf_script_l10n.ajaxurl,{action:"vls_gf_get_album_page",album_id:b,page_no:_},function(l){m.find(".vls-gf-thumbnail-container").append(l);var t=m.find(".vls-gf-page:last");u(t),a().vlsGfLazyload&&t.find("img[data-original]").vlsGfLazyload({threshold:100,effect:"fadeIn"}),T=!1,c.removeClass("vls-gf-busy"),_>=y&&(a(s).off("scroll.vls-gf-"+b),c.remove())},"html"),!1}function v(){if(!T){var l=a(s),t=l.scrollTop()+l.height(),e=c.offset().top;t>e&&g()}}function u(l){l.removeClass("vls-gf-hidden"),e();var t=l.closest(".vls-gf-album").data("vlsGfLightbox");t&&"function"==typeof t.updateTargets&&t.updateTargets(l,!0),a(s).trigger("scroll.vls-gf-lazyload")}function p(l){var t=80,e=4,n=Math.floor(a(s).scrollTop()),f=l.closest(".vls-gf-thumbnail-container").offset().top;if(n>f){var o=t;a(s).width()<=640&&(o=e),a("html,body").scrollTop(f-o)}}var c,h,m=a(l),b=m.data("vlsGfAlbumId"),G="",C="none",_=1,y=m.data("vlsGfTotalPages"),T=!1;return t(),{updateLayout:e}}var n=this;return t(),this},a(l).ready(function(){a(".vls-gf-album").vlsGfAlbum()})}(jQuery,window,document);